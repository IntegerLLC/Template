import{api as e,html as t,svg as n}from"./index.js";import{root as l,cleanup as s}from"./observable.js";const u=e=>"function"==typeof e,o=3,r=4,i=7;function c(e,t){return function(e,t){return e.push({type:8}),e.reduce(((e,n)=>{let l=e[0],s=e[1];if(n.type===i)l.push(function(e,t){let n=0;for(;!"#.:[".includes(e[n])&&n!==e.length;)n++;return e.slice(0,n)+"."+t+e.slice(n)}(n.token,t));else if(6===n.type)s.push(l.join("")),s.push(n.token),l=[];else{if(8===n.type)return s.push(l.join("")),s;l.push(n.token)}return[l,s]}),[[],[]])}(function(e){e=e.flatMap((e=>"string"==typeof e?e.split(""):e));let t,n,l,s=[],c=0,p=[];function f(){s.push({token:p.join(""),type:t}),t=void 0,p=[]}for(let h=0;h<e.length;h++)n=e[h],l=p.length,u(n)?(l&&f(),s.push({token:n,type:6})):c?(l||(t=1),p.push(n),"{"===n?c++:"}"===n&&(c--,c||f())):"{"===n?(l&&f(),c++,t=1,p.push(n)):","===n?(l&&t!==o&&f(),t=2,p.push(n),f()):">+~".includes(n)&&t!==i?l&&t!==o?(f(),s.push({token:n,type:5})):p.push(n):" \n\t\r".includes(n)?(l&&![r,o].includes(t)&&f(),t=r,p.push(n)):"@"===n?(l&&f(),t=o,p.push(n)):l?([i,o].includes(t)||(f(),t=i),p.push(n)):(t=i,p.push(n));return p.length&&f(),s}(e),t)}let p,f={},h=new Set([]);const a=(e,t)=>(...n)=>t(...e(...n));let d=e.h;e.h=a((function(...e){if("style"===e[0]&&e[1]&&(e[1].local||e[1].global)){let t=e[1],n=t.local,s=t.class;t.class=p+" "+(t.class||"");let u=(n?p+"-local":p+"-global")+(s?"-"+s:"");if(h.has(u)||y.querySelector("#"+u))return[];h.add(u),t.id=u;let o=n?c(e.slice(2),p):e.slice(2);return function(e){y.append(e)}(l((()=>d(e[0],t,...o)))),[]}return m(...e)}),e.h),e.hs=a(m,e.hs);let y=document.querySelector("head");function g(e,t){let n=p;p=e;let l=t();return p=n,l}function m(...e){if(u(e[0])){let t=e[0].$s;for(let n=2;n<e.length;n++)if(u(e[n])){let l=e[n];e[n]=()=>g(t,l)}}let t=e[1]||{},n=t.class||"",l=p||"";return t.class=u(n)?()=>n()+" "+l:n+" "+l,e[1]=t,e}function k(e){return(...t)=>Array.isArray(t[0])?g("",(()=>e(...t))):(...n)=>g(t.length?t[0]:p,(()=>{for(let e of n)u(e)&&(e.$s=p);let t=p;return f[t]?f[t]++:f[t]=1,s((()=>{--f[t]<1&&(delete f[t],function(e){for(let t of y.querySelectorAll("."+e))"STYLE"===t.nodeName&&(h.delete(t.id),t.remove())}(t))})),e(...n)}))}const j=k(t),S=k(n);export{j as html,S as svg};
